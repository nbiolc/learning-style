<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <!-- インラインJSを許可（'unsafe-inline'）しつつ、外部通信は禁止 -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; img-src 'self' data:; style-src 'self' 'unsafe-inline';
                 script-src 'self' 'unsafe-inline'; connect-src 'none'; frame-ancestors 'self';">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>あなたの学び方のタイプを探ってみよう！（12問）</title>
  <style>
    :root { --maxw: 860px; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Hiragino Sans", "Noto Sans JP", "Yu Gothic", "Meiryo", sans-serif; line-height: 1.6; margin: 0; background: #fafafa; color: #222; }
    header { background: #0ea5e9; color: white; padding: 18px 16px; }
    header h1 { margin: 0 0 4px 0; font-size: 1.4rem; }
    header p { margin: 0; opacity: 0.95; }
    main { max-width: var(--maxw); margin: 20px auto; padding: 0 16px 32px; }
    .card { background: white; border-radius: 14px; box-shadow: 0 6px 18px rgba(0,0,0,0.06); padding: 18px; margin: 14px 0; }
    .q { margin: 14px 0; padding: 12px 12px 6px; border: 1px solid #eee; border-radius: 12px; }
    .q h3 { margin: 0 0 8px; font-size: 1rem; }
    .scale { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
    .opt { background:#f7f7f7; border-radius: 10px; padding: 8px; text-align: center; border: 1px solid #eee; cursor: pointer; }
    .opt input { margin-right: 6px; }
    .legend { font-size: .9rem; color:#555; display:flex; justify-content:space-between; margin-top:6px; }
    button { appearance: none; border: none; background: #0ea5e9; color: white; padding: 12px 18px; border-radius: 12px; font-size: 1rem; cursor: pointer; box-shadow: 0 6px 14px rgba(14,165,233,.35); }
    button:hover { filter: brightness(1.05); }
    .muted { background:#94a3b8; box-shadow: 0 6px 14px rgba(148,163,184,.35); }
    .results h2 { margin-top: 0; }
    .grid { display:grid; grid-template-columns: 1fr; gap: 14px; }
    @media (min-width: 720px) { .grid { grid-template-columns: 1fr 1fr; } }
    .bar { height: 12px; background:#e5f4fb; border-radius: 999px; overflow: hidden; border:1px solid #c7e7f7; }
    .bar > span { display:block; height:100%; background:#0ea5e9; width:0%; transition: width .6s ease; }
    .type { display:flex; align-items:center; justify-content:space-between; font-weight:600; }
    .pill { font-size: .8rem; padding: 2px 8px; background:#eef7ff; border:1px solid #d8ecff; border-radius:999px; margin-left: 8px; }
    .advice { font-size: .95rem; color:#333; margin-top:8px; }
    footer { text-align:center; color:#666; font-size:.88rem; margin: 28px 0 40px; }
    .notice { font-size:.92rem; color:#555; }
    /* 未回答の可視化 */
    .q.error { border-color:#ef4444; background:#fff7f7; box-shadow:0 0 0 2px rgba(239,68,68,.15) inset; }
    /* バッジ */
    .badges .pill { margin-right:8px; }
  </style>
</head>
<body>
  <header>
    <h1>あなたの学び方のタイプは？</h1>
    <p>各質問を1〜5で選び、「結果を見る」を押すと合計点と上位2タイプがわかります。</p>
  </header>
  <main>
    <section class="card">
      <h2>回答方法</h2>
      <p class="notice">1 = まったくあてはまらない ／ 5 = とてもあてはまる</p>
      <p class="notice">（目安：同意度が 0–20%なら「1」、20–40%「2」、40–60%「3」、60–80%「4」、80–100%「5」）</p>
    </section>

    <form id="quiz" novalidate>
      <section class="card">
        <!-- 12問：名称は q1〜q12 固定 -->
        <div class="q">
          <h3>① わからないところは、納得できるまで自分で調べたり考えたりしたい。</h3>
          <div class="scale" data-q="1">
            <label class="opt"><input type="radio" name="q1" value="1">1</label>
            <label class="opt"><input type="radio" name="q1" value="2">2</label>
            <label class="opt"><input type="radio" name="q1" value="3">3</label>
            <label class="opt"><input type="radio" name="q1" value="4">4</label>
            <label class="opt"><input type="radio" name="q1" value="5">5</label>
          </div>
          <div class="legend"><span>1 まったくあてはまらない</span><span>5 とてもあてはまる</span></div>
        </div>

        <div class="q">
          <h3>② 友達や先生に「よくがんばってるね」と言われるとやる気が出る。</h3>
          <div class="scale" data-q="2">
            <label class="opt"><input type="radio" name="q2" value="1">1</label>
            <label class="opt"><input type="radio" name="q2" value="2">2</label>
            <label class="opt"><input type="radio" name="q2" value="3">3</label>
            <label class="opt"><input type="radio" name="q2" value="4">4</label>
            <label class="opt"><input type="radio" name="q2" value="5">5</label>
          </div>
          <div class="legend"><span>1</span><span>5</span></div>
        </div>

        <div class="q">
          <h3>③ 新しいことを試したり、自分のやり方で勉強してみるのが好きだ。</h3>
          <div class="scale" data-q="3">
            <label class="opt"><input type="radio" name="q3" value="1">1</label>
            <label class="opt"><input type="radio" name="q3" value="2">2</label>
            <label class="opt"><input type="radio" name="q3" value="3">3</label>
            <label class="opt"><input type="radio" name="q3" value="4">4</label>
            <label class="opt"><input type="radio" name="q3" value="5">5</label>
          </div>
          <div class="legend"><span>1</span><span>5</span></div>
        </div>

        <div class="q">
          <h3>④ 勉強の計画を立てると安心できる。</h3>
          <div class="scale" data-q="4">
            <label class="opt"><input type="radio" name="q4" value="1">1</label>
            <label class="opt"><input type="radio" name="q4" value="2">2</label>
            <label class="opt"><input type="radio" name="q4" value="3">3</label>
            <label class="opt"><input type="radio" name="q4" value="4">4</label>
            <label class="opt"><input type="radio" name="q4" value="5">5</label>
          </div>
          <div class="legend"><span>1</span><span>5</span></div>
        </div>

        <div class="q">
          <h3>⑤ ただ暗記するよりも、「どうしてそうなるのか」を知りたい。</h3>
          <div class="scale" data-q="5">
            <label class="opt"><input type="radio" name="q5" value="1">1</label>
            <label class="opt"><input type="radio" name="q5" value="2">2</label>
            <label class="opt"><input type="radio" name="q5" value="3">3</label>
            <label class="opt"><input type="radio" name="q5" value="4">4</label>
            <label class="opt"><input type="radio" name="q5" value="5">5</label>
          </div>
          <div class="legend"><span>1</span><span>5</span></div>
        </div>

        <div class="q">
          <h3>⑥ まわりの人の役に立てると、もっと頑張ろうと思える。</h3>
          <div class="scale" data-q="6">
            <label class="opt"><input type="radio" name="q6" value="1">1</label>
            <label class="opt"><input type="radio" name="q6" value="2">2</label>
            <label class="opt"><input type="radio" name="q6" value="3">3</label>
            <label class="opt"><input type="radio" name="q6" value="4">4</label>
            <label class="opt"><input type="radio" name="q6" value="5">5</label>
          </div>
          <div class="legend"><span>1</span><span>5</span></div>
        </div>

        <div class="q">
          <h3>⑦ 思いついたアイデアをどんどんメモしたり、形にしたりするのが得意。</h3>
          <div class="scale" data-q="7">
            <label class="opt"><input type="radio" name="q7" value="1">1</label>
            <label class="opt"><input type="radio" name="q7" value="2">2</label>
            <label class="opt"><input type="radio" name="q7" value="3">3</label>
            <label class="opt"><input type="radio" name="q7" value="4">4</label>
            <label class="opt"><input type="radio" name="q7" value="5">5</label>
          </div>
          <div class="legend"><span>1</span><span>5</span></div>
        </div>

        <div class="q">
          <h3>⑧ 同じ方法をくり返して少しずつ完成度を上げていくのが好きだ。</h3>
          <div class="scale" data-q="8">
            <label class="opt"><input type="radio" name="q8" value="1">1</label>
            <label class="opt"><input type="radio" name="q8" value="2">2</label>
            <label class="opt"><input type="radio" name="q8" value="3">3</label>
            <label class="opt"><input type="radio" name="q8" value="4">4</label>
            <label class="opt"><input type="radio" name="q8" value="5">5</label>
          </div>
          <div class="legend"><span>1</span><span>5</span></div>
        </div>

        <div class="q">
          <h3>⑨ 「これをやる意味」を理解してからじゃないとやる気が出ない。</h3>
          <div class="scale" data-q="9">
            <label class="opt"><input type="radio" name="q9" value="1">1</label>
            <label class="opt"><input type="radio" name="q9" value="2">2</label>
            <label class="opt"><input type="radio" name="q9" value="3">3</label>
            <label class="opt"><input type="radio" name="q9" value="4">4</label>
            <label class="opt"><input type="radio" name="q9" value="5">5</label>
          </div>
          <div class="legend"><span>1</span><span>5</span></div>
        </div>

        <div class="q">
          <h3>⑩ 決めたことは途中で変えるより、最後までやり通したい。</h3>
          <div class="scale" data-q="10">
            <label class="opt"><input type="radio" name="q10" value="1">1</label>
            <label class="opt"><input type="radio" name="q10" value="2">2</label>
            <label class="opt"><input type="radio" name="q10" value="3">3</label>
            <label class="opt"><input type="radio" name="q10" value="4">4</label>
            <label class="opt"><input type="radio" name="q10" value="5">5</label>
          </div>
          <div class="legend"><span>1</span><span>5</span></div>
        </div>

        <!-- 追加：協調タイプの補強 -->
        <div class="q">
          <h3>⑪ クラスメイトや友達と一緒に勉強すると、ひとりでやるよりも集中できる。</h3>
          <div class="scale" data-q="11">
            <label class="opt"><input type="radio" name="q11" value="1">1</label>
            <label class="opt"><input type="radio" name="q11" value="2">2</label>
            <label class="opt"><input type="radio" name="q11" value="3">3</label>
            <label class="opt"><input type="radio" name="q11" value="4">4</label>
            <label class="opt"><input type="radio" name="q11" value="5">5</label>
          </div>
          <div class="legend"><span>1</span><span>5</span></div>
        </div>

        <!-- 追加：創造タイプの補強 -->
        <div class="q">
          <h3>⑫ 興味をもったことは、予定を変えてでもすぐに試してみたくなる。</h3>
          <div class="scale" data-q="12">
            <label class="opt"><input type="radio" name="q12" value="1">1</label>
            <label class="opt"><input type="radio" name="q12" value="2">2</label>
            <label class="opt"><input type="radio" name="q12" value="3">3</label>
            <label class="opt"><input type="radio" name="q12" value="4">4</label>
            <label class="opt"><input type="radio" name="q12" value="5">5</label>
          </div>
          <div class="legend"><span>1</span><span>5</span></div>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:16px;">
          <button type="button" id="calcBtn" aria-label="結果を表示">結果を見る</button>
          <button type="reset" id="resetBtn" class="muted" aria-label="リセット">リセット</button>
        </div>
      </section>
    </form>

    <section class="card results" id="results" style="display:none;" aria-live="polite">
      <h2>結果</h2>
      <div class="grid">
        <div>
          <div class="type">探究タイプ <span class="pill">理屈・理解・整理</span></div>
          <div class="bar" aria-hidden="true"><span id="bar-tankyu"></span></div>
          <div class="advice" id="score-tankyu"></div>
        </div>
        <div>
          <div class="type">協調タイプ <span class="pill">人・つながり・共感</span></div>
          <div class="bar" aria-hidden="true"><span id="bar-kyoucho"></span></div>
          <div class="advice" id="score-kyoucho"></div>
        </div>
        <div>
          <div class="type">創造タイプ <span class="pill">発想・柔軟・挑戦</span></div>
          <div class="bar" aria-hidden="true"><span id="bar-souzou"></span></div>
          <div class="advice" id="score-souzou"></div>
        </div>
        <div>
          <div class="type">計画タイプ <span class="pill">安定・積み上げ・継続</span></div>
          <div class="bar" aria-hidden="true"><span id="bar-keikaku"></span></div>
          <div class="advice" id="score-keikaku"></div>
        </div>
      </div>

      <div class="card" style="background:#f8fbff; border:1px solid #e5f1ff;">
        <h3>あなたの上位2タイプ</h3>
        <p id="top2"></p>
        <ul id="quick-tips"></ul>
       </div>

      <div class="badges">
        <span class="pill">No Cookies</span>
        <span class="pill">No Tracking</span>
        <span class="pill">Offline OK</span>
      </div>
    </section>

    <section class="card">
      <h3>この診断のプライバシーについて</h3>
      <p class="notice">入力はすべてブラウザ内で処理され、サーバに送信・保存されません。外部解析タグ・広告タグは使用していません。ページを保存すればオフラインでも動作します。</p>
      <h3>結果について</h3>
      <p class="notice">これは、今のあなたの“学び方の傾向”を知るための簡単なチェックです。人は経験や環境によって少しずつ変わっていくもの。結果にとらわれすぎず、今の自分に合う方法を見つけるヒントとして活用してください。</p>
    </section>
    <footer>長浜バイオ大学 学習支援センター</footer>
  </main>

  <script>
    // 12問：各タイプ3問ずつ（最大15点）
    const mapping = {
      tankyu: [1,5,9],     // 探究タイプ
      kyoucho: [2,6,11],   // 協調タイプ
      souzou: [3,7,12],    // 創造タイプ
      keikaku: [4,8,10]    // 計画タイプ
    };
    const maxScores = { tankyu: 15, kyoucho: 15, souzou: 15, keikaku: 15 };

    function getValue(q) {
      const el = document.querySelector(`input[name="q${q}"]:checked`);
      return el ? parseInt(el.value, 10) : 0;
    }
    function sum(arr){ return arr.reduce((a,b)=>a+b,0); }

    // 同点優先
    function compareTypes(a, b) {
      const [ka, va] = a;
      const [kb, vb] = b;
      if (va !== vb) return vb - va; // 高得点優先
      if ((ka === 'souzou' && kb === 'keikaku')) return 1;
      if ((ka === 'keikaku' && kb === 'souzou')) return -1;
      if ((ka === 'tankyu' && kb === 'kyoucho')) return 1;
      if ((ka === 'kyoucho' && kb === 'tankyu')) return -1;
      // 安定表示のための並び
      const order = ['kyoucho','tankyu','keikaku','souzou'];
      return order.indexOf(ka) - order.indexOf(kb);
    }

    // 反応スタイル検知（極端・規則・低ばらつき）
    function detectResponseStyle(values) {
      const n = values.length;
      const set = new Set(values);

      // (1) 全て同じ
      if (set.size === 1) {
        return "同じ番号を選び続けています。正確な結果が出ない可能性があります。";
      }

      // (2) ばらつき（分散）が極端に小さい
      const mean = sum(values) / n;
      const variance = values.reduce((s,v)=>s+Math.pow(v-mean,2),0) / n;
      if (variance < 0.15) {
        return "選択にほとんどばらつきがありません。正確な結果が出ない可能性があります。";
      }

      // (3) 完全な単調列（1ずつ増減）
      let monoStep1 = true;
      let d = values[1] - values[0];
      if (Math.abs(d) !== 1) monoStep1 = false;
      for (let i=1; monoStep1 && i<n-1; i++) {
        if (values[i+1] - values[i] !== d) monoStep1 = false;
      }
      if (monoStep1) {
        return "1ずつ増減する規則的な選択が続いています。正確な結果が出ない可能性があります。";
      }

      // (4) 1..5..1 の“波形”に近いジグザグ（境界で反転しつつ常に±1刻み）
      let zigzag = true;
      for (let i=0; i<n-1; i++) {
        const diff = values[i+1] - values[i];
        if (Math.abs(diff) !== 1) { zigzag = false; break; }
        // 1のときは次は+1、5のときは次は-1
        if ((values[i] === 1 && diff !== 1) || (values[i] === 5 && diff !== -1)) { zigzag = false; break; }
      }
      if (zigzag) {
        return "「1→2→3→4→5→4→…」のような規則的な選択が続いています。正確な結果が出ない可能性があります。";
      }

      return null; // 問題なし
    }

    function calc() {
      // ===== 未回答チェック（DOMから動的にカウント） =====
      const TOTAL = document.querySelectorAll('.scale').length;
      document.querySelectorAll('.q.error').forEach(el => el.classList.remove('error'));
      const missing = [];
      for (let q = 1; q <= TOTAL; q++) {
        if (!document.querySelector(`input[name="q${q}"]:checked`)) {
          missing.push(q);
        }
      }
      if (missing.length > 0) {
        const firstName = `q${missing[0]}`;
        const firstInput = document.querySelector(`input[name="${firstName}"]`);
        const container = firstInput ? firstInput.closest('.q') : null;
        if (container) {
          container.classList.add('error');
          container.scrollIntoView({ behavior: 'smooth', block: 'center' });
          container.setAttribute('tabindex', '-1');
          container.focus({ preventScroll: true });
        }
        alert(`未回答の設問があります：${missing.join('、')}（各設問は1～5を選択してください）`);
        return; // 中断
      }
      // ===== 未回答チェックここまで =====

      // ===== 反応スタイル検知（ここで実行） =====
      const values = [];
      for (let q = 1; q <= TOTAL; q++) values.push(getValue(q));
      const warn = detectResponseStyle(values);
      if (warn) {
        const proceed = confirm(`${warn}\n\nこのまま結果を表示しますか？（キャンセルで見直し）`);
        if (!proceed) {
          // 先頭にスクロールして見直しやすく
          document.querySelector('.q')?.scrollIntoView({ behavior:'smooth', block:'start' });
          return; // 中断
        }
      }
      // ===== 検知ここまで =====

      // 集計
      const scores = {
        tankyu: sum(mapping.tankyu.map(getValue)),
        kyoucho: sum(mapping.kyoucho.map(getValue)),
        souzou: sum(mapping.souzou.map(getValue)),
        keikaku: sum(mapping.keikaku.map(getValue))
      };

      // 表示更新
      const pct = (v, max) => Math.round((v / max) * 100);
      document.getElementById('bar-tankyu').style.width = pct(scores.tankyu, maxScores.tankyu) + '%';
      document.getElementById('bar-kyoucho').style.width = pct(scores.kyoucho, maxScores.kyoucho) + '%';
      document.getElementById('bar-souzou').style.width = pct(scores.souzou, maxScores.souzou) + '%';
      document.getElementById('bar-keikaku').style.width = pct(scores.keikaku, maxScores.keikaku) + '%';

      document.getElementById('score-tankyu').textContent = `合計 ${scores.tankyu} / ${maxScores.tankyu}`;
      document.getElementById('score-kyoucho').textContent = `合計 ${scores.kyoucho} / ${maxScores.kyoucho}`;
      document.getElementById('score-souzou').textContent = `合計 ${scores.souzou} / ${maxScores.souzou}`;
      document.getElementById('score-keikaku').textContent = `合計 ${scores.keikaku} / ${maxScores.keikaku}`;

      // 上位2タイプ（FFSタイブレーク適用）
      const entries = Object.entries(scores).sort(compareTypes);
      const label = { tankyu: "探究タイプ", kyoucho: "協調タイプ", souzou: "創造タイプ", keikaku: "計画タイプ" };
      const top2 = entries.slice(0,2).map(([k,v]) => `${label[k]}（${v}点）`).join(" ／ ");
      document.getElementById('top2').textContent = top2;

      // タイプ別クイックTips
      const tips = {
        tankyu: "探究タイプ（理解・整理・因果で考える人）； まず“なぜそうなるのか”を理解してから覚えると定着が早まります。試験前は、公式や重要語を“理由の流れ”とセットで整理するのがベスト。",
        kyoucho: "協調タイプ（人・つながり・共感で伸びる人）； 誰かに説明すると理解が深まります。試験前は、友達に要点を教えたり、声に出して説明してみよう。言葉にすることで記憶・定着が向上します。",
        souzou: "創造タイプ（発想・柔軟・感覚で覚える人）； イメージで覚えるのが得意。試験前は、図・色・ストーリーで内容を自分なりに再構成してみよう。1時間よりも20分×3回の方が集中できます。",
        keikaku: "計画タイプ（安定・積み上げ・着実に進める人）； 計画を立てて進めると安心できるタイプ。試験前は、まず“残り時間でできることリスト”を作り、今日やる・明日やるを分けて整理しよう。"
      };
      const quick = document.getElementById('quick-tips');
      quick.innerHTML = "";
      entries.slice(0,2).forEach(([k]) => {
        const li = document.createElement('li');
        li.textContent = tips[k];
        quick.appendChild(li);
      });

      document.getElementById('results').style.display = 'block';
      document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
    }

    // ボタンイベント
    document.getElementById('calcBtn').addEventListener('click', calc);
    document.getElementById('resetBtn').addEventListener('click', () => {
      document.getElementById('results').style.display = 'none';
      document.querySelectorAll('.bar > span').forEach(s=> s.style.width = '0%');
      document.getElementById('top2').textContent = '';
      document.getElementById('quick-tips').innerHTML = '';
      document.querySelectorAll('.q.error').forEach(el => el.classList.remove('error'));
    });
  </script>
</body>
</html>
